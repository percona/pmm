---
templates:
  - name: mongodb_high_memory_usage
    version: 1
    summary: Memory used MongoDB instances
    expr: |-
      sum by (node_name) (mongodb_ss_mem_resident * 1024 * 1024)
      / on (node_name) (node_memory_MemTotal_bytes)
      * 100
      > [[ .threshold ]]
    params:
      - name: threshold
        summary: A percentage from configured maximum
        unit: "%"
        type: float
        range: [0, 100]
        value: 80
    for: 5m
    severity: warning
    labels:
      ticket: PMM-7135
      things_to_do: "yes"
    annotations:
      description: |-
        This template is not finished: https://jira.percona.com/browse/PMM-7135
        More than [[ .threshold ]]% of Memory used by MongoDB service on {{ $labels.node_name }}
        VALUE = {{ $value }}
        LABELS: {{ $labels }}
      summary: MongoDB high memory usage (instance {{ $labels.node_name }})
