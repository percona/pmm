syntax = "proto3";

package platform;

option go_package = "api/platformpb;platformpb";

import "github.com/mwitkow/go-proto-validators/validator.proto";
import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

message ConnectRequest {
  // User defined human readable PMM Server Name.
  string server_name = 1 [
    (validator.field) = {
      string_not_empty: true
    }
  ];
  // Existing Percona Platform user's email.
  string email = 2 [
    (validator.field) = {
      string_not_empty: true
    }
  ];
  // Existing Percona Platform user's password.
  string password = 3 [
    (validator.field) = {
      string_not_empty: true
    }
  ];
}

message ConnectResponse {}

message DisconnectRequest {}

message DisconnectResponse {}

message SearchOrganizationTicketsRequest {}

message SearchOrganizationTicketsResponse {
  // Support tickets belonging to the Percona Portal Organization.
  repeated OrganizationTicket tickets = 1;
}

// OrganizationTicket contains information about the support ticket.
message OrganizationTicket {
  // Ticket number.
  string number = 1;
  // Ticket short description.
  string short_description = 2;
  // Ticket priority.
  string priority = 3;
  // Ticket state.
  string state = 4;
  // Ticket creation time.
  google.protobuf.Timestamp create_time = 5;
  // Department.
  string department = 6;
  // Ticket requester.
  string requester = 7;
  // Task type.
  string task_type = 8;
  // Ticket url.
  string url = 9;
}

// Platform contains rpcs related to Percona Platform.
service Platform {
  // Connect a PMM server to the organization created on Percona Portal. That allows the user to sign in to the PMM server with their Percona Account.
  rpc Connect(ConnectRequest) returns (ConnectResponse) {
    option (google.api.http) = {
      post: "/v1/Platform/Connect"
      body: "*"
    };
  }
  // Disconnect a PMM server from the organization created on Percona Portal.
  rpc Disconnect(DisconnectRequest) returns (DisconnectResponse) {
    option (google.api.http) = {
      post: "/v1/Platform/Disconnect"
      body: "*"
    };
  }
  // SearchOrganizationTickets searches support tickets belonging to the Percona Portal Organization that the PMM server is connected to.
  rpc SearchOrganizationTickets(SearchOrganizationTicketsRequest) returns (SearchOrganizationTicketsResponse) {
    option (google.api.http) = {
      post: "/v1/Platform/SearchOrganizationTickets"
      body: "*"
    };
  }
}
