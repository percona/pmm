{
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "schemes": [
    "https",
    "http"
  ],
  "swagger": "2.0",
  "info": {
    "title": "PMM Management API",
    "version": "version 1.alpha"
  },
  "paths": {
    "/v1/management/MySQL/Add": {
      "post": {
        "tags": [
          "MySQL"
        ],
        "summary": "Add MySQL adds MySQL Service and starts several Agents.\nIt automatically adds a service to inventory, which is running on provided \"node_id\",\nthen adds \"mysqld_exporter\", and \"qan_mysql_perfschema\" agents\nwith provided \"pmm_agent_id\" and other parameters.",
        "operationId": "AddMixin0",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "address": {
                  "description": "Node and Service access address (DNS name or IP). Required.",
                  "type": "string"
                },
                "mysqld_exporter": {
                  "description": "If true, adds mysqld_exporter for provided service.",
                  "type": "boolean",
                  "format": "boolean"
                },
                "node_id": {
                  "description": "Node identifier on which a service is been running. Required.",
                  "type": "string"
                },
                "password": {
                  "description": "MySQL password for scraping metrics.",
                  "type": "string"
                },
                "pmm_agent_id": {
                  "description": "The \"pmm-agent\" identifier which should run agents. Required.",
                  "type": "string"
                },
                "port": {
                  "description": "Service Access port. Required.",
                  "type": "integer",
                  "format": "int64"
                },
                "qan_mysql_perfschema": {
                  "description": "If true, adds qan-mysql-perfschema-agent for provided service.",
                  "type": "boolean",
                  "format": "boolean"
                },
                "qan_mysql_slowlog": {
                  "description": "If true, adds qan-mysql-slowlog-agent for provided service.",
                  "type": "boolean",
                  "format": "boolean"
                },
                "qan_password": {
                  "type": "string",
                  "title": "FIXME remove"
                },
                "qan_username": {
                  "type": "string",
                  "title": "FIXME remove"
                },
                "service_name": {
                  "description": "Unique across all Services user-defined name. Required.",
                  "type": "string"
                },
                "username": {
                  "description": "MySQL username for scraping metrics.",
                  "type": "string"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object",
              "properties": {
                "mysqld_exporter": {
                  "description": "MySQLdExporter runs on Generic or Container Node and exposes MySQL and AmazonRDSMySQL Service metrics.",
                  "type": "object",
                  "properties": {
                    "agent_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "disabled": {
                      "description": "Desired Agent status: enabled (false) or disabled (true).",
                      "type": "boolean",
                      "format": "boolean"
                    },
                    "listen_port": {
                      "description": "Listen port for scraping metrics.",
                      "type": "integer",
                      "format": "int64"
                    },
                    "password": {
                      "description": "MySQL password for scraping metrics.",
                      "type": "string"
                    },
                    "pmm_agent_id": {
                      "description": "The pmm-agent identifier which runs this instance.",
                      "type": "string"
                    },
                    "service_id": {
                      "description": "Service identifier.",
                      "type": "string"
                    },
                    "status": {
                      "description": "AgentStatus represents actual Agent status.",
                      "type": "string",
                      "default": "AGENT_STATUS_INVALID",
                      "enum": [
                        "AGENT_STATUS_INVALID",
                        "STARTING",
                        "RUNNING",
                        "WAITING",
                        "STOPPING",
                        "DONE"
                      ]
                    },
                    "username": {
                      "description": "MySQL username for scraping metrics.",
                      "type": "string"
                    }
                  }
                },
                "qan_mysql_perfschema": {
                  "description": "QANMySQLPerfSchemaAgent runs within pmm-agent and sends MySQL Query Analytics data to the PMM Server.",
                  "type": "object",
                  "properties": {
                    "agent_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "disabled": {
                      "description": "Desired Agent status: enabled (false) or disabled (true).",
                      "type": "boolean",
                      "format": "boolean"
                    },
                    "password": {
                      "description": "MySQL password for getting performance data.",
                      "type": "string"
                    },
                    "pmm_agent_id": {
                      "description": "The pmm-agent identifier which runs this instance.",
                      "type": "string"
                    },
                    "service_id": {
                      "description": "Service identifier.",
                      "type": "string"
                    },
                    "status": {
                      "description": "AgentStatus represents actual Agent status.",
                      "type": "string",
                      "default": "AGENT_STATUS_INVALID",
                      "enum": [
                        "AGENT_STATUS_INVALID",
                        "STARTING",
                        "RUNNING",
                        "WAITING",
                        "STOPPING",
                        "DONE"
                      ]
                    },
                    "username": {
                      "description": "MySQL username for getting performance data.",
                      "type": "string"
                    }
                  }
                },
                "qan_mysql_slowlog": {
                  "description": "QANMySQLSlowlogAgent runs within pmm-agent and sends MySQL Query Analytics data to the PMM Server.",
                  "type": "object",
                  "properties": {
                    "agent_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "disabled": {
                      "description": "Desired Agent status: enabled (false) or disabled (true).",
                      "type": "boolean",
                      "format": "boolean"
                    },
                    "password": {
                      "description": "MySQL password for getting performance data.",
                      "type": "string"
                    },
                    "pmm_agent_id": {
                      "description": "The pmm-agent identifier which runs this instance.",
                      "type": "string"
                    },
                    "service_id": {
                      "description": "Service identifier.",
                      "type": "string"
                    },
                    "status": {
                      "description": "AgentStatus represents actual Agent status.",
                      "type": "string",
                      "default": "AGENT_STATUS_INVALID",
                      "enum": [
                        "AGENT_STATUS_INVALID",
                        "STARTING",
                        "RUNNING",
                        "WAITING",
                        "STOPPING",
                        "DONE"
                      ]
                    },
                    "username": {
                      "description": "MySQL username for getting performance data.",
                      "type": "string"
                    }
                  }
                },
                "service": {
                  "description": "MySQLService represents a generic MySQL instance.",
                  "type": "object",
                  "properties": {
                    "address": {
                      "description": "Access address (DNS name or IP).",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "node_id": {
                      "description": "Node identifier where this instance runs.",
                      "type": "string"
                    },
                    "port": {
                      "description": "Access port.",
                      "type": "integer",
                      "format": "int64"
                    },
                    "service_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "service_name": {
                      "description": "Unique across all Services user-defined name.",
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "default": {
            "description": "An error response.",
            "schema": {
              "description": "ErrorResponse is a message returned on HTTP error.",
              "type": "object",
              "properties": {
                "code": {
                  "type": "integer",
                  "format": "int32"
                },
                "error": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/management/Node/Register": {
      "post": {
        "tags": [
          "Node"
        ],
        "summary": "Register do node registration.",
        "operationId": "Register",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "address": {
                  "type": "string",
                  "title": "Address FIXME https://jira.percona.com/browse/PMM-3786"
                },
                "container_id": {
                  "description": "Сontainer identifier. Only for Container Nodes (optional).",
                  "type": "string"
                },
                "container_name": {
                  "description": "Сontainer name. Only for Container Nodes (optional).",
                  "type": "string"
                },
                "custom_labels": {
                  "description": "Custom user-assigned labels for node (optional).",
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                "distro": {
                  "description": "Linux distribution. For Generic nodes (optional).",
                  "type": "string"
                },
                "machine_id": {
                  "description": "Linux machine-id. Can't be changed. Must be unique across all Generic Nodes if specified (optional).",
                  "type": "string"
                },
                "node_name": {
                  "description": "Unique across all Nodes user-defined name, can be changed.",
                  "type": "string"
                },
                "node_type": {
                  "description": "NodeType describes supported node types.",
                  "type": "string",
                  "default": "NODE_TYPE_INVALID",
                  "enum": [
                    "NODE_TYPE_INVALID",
                    "GENERIC_NODE",
                    "CONTAINER_NODE",
                    "REMOTE_NODE",
                    "REMOTE_AMAZON_RDS_NODE"
                  ]
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object",
              "properties": {
                "container_node": {
                  "description": "ContainerNode represents a Docker container.",
                  "type": "object",
                  "properties": {
                    "address": {
                      "type": "string",
                      "title": "Address FIXME https://jira.percona.com/browse/PMM-3786"
                    },
                    "az": {
                      "description": "Node availability zone. Auto-detected and auto-updated.",
                      "type": "string"
                    },
                    "container_id": {
                      "description": "Container identifier. If specified, must be a unique Docker container identifier.\nAuto-detected and auto-updated.",
                      "type": "string"
                    },
                    "container_name": {
                      "description": "Container name. Auto-detected and auto-updated.",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "machine_id": {
                      "description": "Linux machine-id of the Generic Node where this Container Node runs. Auto-detected and auto-updated.\nIf defined, Generic Node with that machine_id must exist.",
                      "type": "string"
                    },
                    "node_id": {
                      "description": "Unique randomly generated instance identifier. Can't be changed.",
                      "type": "string"
                    },
                    "node_model": {
                      "description": "Node model. Auto-detected and auto-updated.",
                      "type": "string"
                    },
                    "node_name": {
                      "description": "Unique across all Nodes user-defined name. Can't be changed.",
                      "type": "string"
                    },
                    "region": {
                      "description": "Node region. Auto-detected and auto-updated.",
                      "type": "string"
                    }
                  }
                },
                "generic_node": {
                  "description": "GenericNode represents a bare metal server or virtual machine.",
                  "type": "object",
                  "properties": {
                    "address": {
                      "type": "string",
                      "title": "Address FIXME https://jira.percona.com/browse/PMM-3786"
                    },
                    "az": {
                      "description": "Node availability zone. Auto-detected and auto-updated.",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels. Can be changed.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "distro": {
                      "description": "Linux distribution name and version. Auto-detected and auto-updated.",
                      "type": "string"
                    },
                    "machine_id": {
                      "description": "Linux machine-id. Auto-detected and auto-updated.\nMust be unique across all Generic Nodes if specified.",
                      "type": "string"
                    },
                    "node_id": {
                      "description": "Unique randomly generated instance identifier. Can't be changed.",
                      "type": "string"
                    },
                    "node_model": {
                      "description": "Node model. Auto-detected and auto-updated.",
                      "type": "string"
                    },
                    "node_name": {
                      "description": "Unique across all Nodes user-defined name. Can't be changed.",
                      "type": "string"
                    },
                    "region": {
                      "description": "Node region. Auto-detected and auto-updated.",
                      "type": "string"
                    }
                  }
                },
                "pmm_agent": {
                  "description": "PMMAgent runs on Generic on Container Node.",
                  "type": "object",
                  "properties": {
                    "agent_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "connected": {
                      "description": "True if Agent is running and connected to pmm-managed.",
                      "type": "boolean",
                      "format": "boolean"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "runs_on_node_id": {
                      "description": "Node identifier where this instance runs.",
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "default": {
            "description": "An error response.",
            "schema": {
              "description": "ErrorResponse is a message returned on HTTP error.",
              "type": "object",
              "properties": {
                "code": {
                  "type": "integer",
                  "format": "int32"
                },
                "error": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/management/PostgreSQL/Add": {
      "post": {
        "tags": [
          "PostgreSQL"
        ],
        "summary": "Add PostgreSQL adds PostgreSQL Service and starts postgres exporter.\nIt automatically adds a service to inventory, which is running on provided \"node_id\",\nthen adds \"postgres_exporter\" with provided \"pmm_agent_id\" and other parameters.",
        "operationId": "Add",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "address": {
                  "description": "Node and Service access address (DNS name or IP). Required.",
                  "type": "string"
                },
                "node_id": {
                  "description": "Node identifier on which a service is been running. Required.",
                  "type": "string"
                },
                "password": {
                  "description": "PostgreSQL password for scraping metrics.",
                  "type": "string"
                },
                "pmm_agent_id": {
                  "description": "The \"pmm-agent\" identifier which should run agents. Required.",
                  "type": "string"
                },
                "port": {
                  "description": "Service Access port. Required.",
                  "type": "integer",
                  "format": "int64"
                },
                "postgres_exporter": {
                  "description": "If true, adds postgres_exporter for provided service.",
                  "type": "boolean",
                  "format": "boolean"
                },
                "qan_password": {
                  "type": "string",
                  "title": "FIXME remove"
                },
                "qan_username": {
                  "type": "string",
                  "title": "FIXME remove"
                },
                "service_name": {
                  "description": "Unique across all Services user-defined name. Required.",
                  "type": "string"
                },
                "username": {
                  "description": "PostgreSQL username for scraping metrics.",
                  "type": "string"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object",
              "properties": {
                "postgres_exporter": {
                  "description": "PostgresExporter runs on Generic or Container Node and exposes PostgreSQL Service metrics.",
                  "type": "object",
                  "properties": {
                    "agent_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "disabled": {
                      "description": "Desired Agent status: enabled (false) or disabled (true).",
                      "type": "boolean",
                      "format": "boolean"
                    },
                    "listen_port": {
                      "description": "Listen port for scraping metrics.",
                      "type": "integer",
                      "format": "int64"
                    },
                    "password": {
                      "description": "PostgreSQL password for scraping metrics.",
                      "type": "string"
                    },
                    "pmm_agent_id": {
                      "description": "The pmm-agent identifier which runs this instance.",
                      "type": "string"
                    },
                    "service_id": {
                      "description": "Service identifier.",
                      "type": "string"
                    },
                    "status": {
                      "description": "AgentStatus represents actual Agent status.",
                      "type": "string",
                      "default": "AGENT_STATUS_INVALID",
                      "enum": [
                        "AGENT_STATUS_INVALID",
                        "STARTING",
                        "RUNNING",
                        "WAITING",
                        "STOPPING",
                        "DONE"
                      ]
                    },
                    "username": {
                      "description": "PostgreSQL username for scraping metrics.",
                      "type": "string"
                    }
                  }
                },
                "service": {
                  "description": "PostgreSQLService represents a generic PostgreSQL instance.",
                  "type": "object",
                  "properties": {
                    "address": {
                      "description": "Access address (DNS name or IP).",
                      "type": "string"
                    },
                    "custom_labels": {
                      "description": "Custom user-assigned labels.",
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    },
                    "node_id": {
                      "description": "Node identifier where this instance runs.",
                      "type": "string"
                    },
                    "port": {
                      "description": "Access port.",
                      "type": "integer",
                      "format": "int64"
                    },
                    "service_id": {
                      "description": "Unique randomly generated instance identifier.",
                      "type": "string"
                    },
                    "service_name": {
                      "description": "Unique across all Services user-defined name.",
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "default": {
            "description": "An error response.",
            "schema": {
              "description": "ErrorResponse is a message returned on HTTP error.",
              "type": "object",
              "properties": {
                "code": {
                  "type": "integer",
                  "format": "int32"
                },
                "error": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/management/Service/Remove": {
      "post": {
        "tags": [
          "Service"
        ],
        "summary": "RemoveService removes Service with Agents.",
        "operationId": "RemoveService",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "service_id": {
                  "description": "Service ID or Service Name is required.\nUnique randomly generated instance identifier.",
                  "type": "string"
                },
                "service_name": {
                  "description": "Unique across all Services user-defined name.",
                  "type": "string"
                },
                "service_type": {
                  "description": "ServiceType describes supported service types.",
                  "type": "string",
                  "default": "SERVICE_TYPE_INVALID",
                  "enum": [
                    "SERVICE_TYPE_INVALID",
                    "MYSQL_SERVICE",
                    "AMAZON_RDS_MYSQL_SERVICE",
                    "MONGODB_SERVICE",
                    "POSTGRESQL_SERVICE"
                  ]
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "object"
            }
          },
          "default": {
            "description": "An error response.",
            "schema": {
              "description": "ErrorResponse is a message returned on HTTP error.",
              "type": "object",
              "properties": {
                "code": {
                  "type": "integer",
                  "format": "int32"
                },
                "error": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  }
}