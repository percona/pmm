{
  "swagger": "2.0",
  "info": {
    "title": "managementpb/postgresql.proto",
    "version": "version not set"
  },
  "tags": [
    {
      "name": "PostgreSQL"
    }
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/management/PostgreSQL/Add": {
      "post": {
        "summary": "Add PostgreSQL",
        "description": "Adds PostgreSQL Service and starts postgres exporter. It automatically adds a service to inventory, which is running on provided \"node_id\", then adds \"postgres_exporter\" with provided \"pmm_agent_id\" and other parameters.",
        "operationId": "AddPostgreSQL",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/managementAddPostgreSQLResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/managementAddPostgreSQLRequest"
            }
          }
        ],
        "tags": [
          "PostgreSQL"
        ]
      }
    }
  },
  "definitions": {
    "inventoryAgentStatus": {
      "type": "string",
      "enum": [
        "AGENT_STATUS_INVALID",
        "STARTING",
        "RUNNING",
        "WAITING",
        "STOPPING",
        "DONE",
        "UNKNOWN"
      ],
      "default": "AGENT_STATUS_INVALID",
      "description": "AgentStatus represents actual Agent status.\n\n - STARTING: Agent is starting.\n - RUNNING: Agent is running.\n - WAITING: Agent encountered error and will be restarted automatically soon.\n - STOPPING: Agent is stopping.\n - DONE: Agent finished.\n - UNKNOWN: Agent is not connected, we don't know anything about it's state."
    },
    "inventoryLogLevel": {
      "type": "string",
      "enum": [
        "auto",
        "fatal",
        "error",
        "warn",
        "info",
        "debug"
      ],
      "default": "auto",
      "title": "Log level for exporters"
    },
    "inventoryNodeType": {
      "type": "string",
      "enum": [
        "NODE_TYPE_INVALID",
        "GENERIC_NODE",
        "CONTAINER_NODE",
        "REMOTE_NODE",
        "REMOTE_RDS_NODE",
        "REMOTE_AZURE_DATABASE_NODE"
      ],
      "default": "NODE_TYPE_INVALID",
      "description": "NodeType describes supported Node types."
    },
    "inventoryPostgreSQLService": {
      "type": "object",
      "properties": {
        "service_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name."
        },
        "database_name": {
          "type": "string",
          "description": "Database name."
        },
        "node_id": {
          "type": "string",
          "description": "Node identifier where this instance runs."
        },
        "address": {
          "type": "string",
          "description": "Access address (DNS name or IP).\nAddress (and port) or socket is required."
        },
        "port": {
          "type": "integer",
          "format": "int64",
          "description": "Access port.\nPort is required when the address present."
        },
        "socket": {
          "type": "string",
          "description": "Access unix socket.\nAddress (and port) or socket is required."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        }
      },
      "description": "PostgreSQLService represents a generic PostgreSQL instance."
    },
    "inventoryPostgresExporter": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "PostgreSQL username for scraping metrics."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation. Uses sslmode=required instead of verify-full."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        },
        "push_metrics_enabled": {
          "type": "boolean",
          "description": "True if exporter uses push metrics mode."
        },
        "disabled_collectors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of disabled collector names."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "listen_port": {
          "type": "integer",
          "format": "int64",
          "description": "Listen port for scraping metrics."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "PostgresExporter runs on Generic or Container Node and exposes PostgreSQL Service metrics."
    },
    "inventoryQANPostgreSQLPgStatMonitorAgent": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "PostgreSQL username for getting pg stat monitor data."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "disable_comments_parsing": {
          "type": "boolean",
          "description": "Disable parsing comments from queries and showing them in QAN."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit)."
        },
        "query_examples_disabled": {
          "type": "boolean",
          "description": "True if query examples are disabled."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "QANPostgreSQLPgStatMonitorAgent runs within pmm-agent and sends PostgreSQL Query Analytics data to the PMM Server."
    },
    "inventoryQANPostgreSQLPgStatementsAgent": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "PostgreSQL username for getting pg stat statements data."
        },
        "disable_comments_parsing": {
          "type": "boolean",
          "description": "Disable parsing comments from queries and showing them in QAN."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit)."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "QANPostgreSQLPgStatementsAgent runs within pmm-agent and sends PostgreSQL Query Analytics data to the PMM Server."
    },
    "managementAddNodeParams": {
      "type": "object",
      "properties": {
        "node_type": {
          "$ref": "#/definitions/inventoryNodeType",
          "description": "Node type to be registered."
        },
        "node_name": {
          "type": "string",
          "description": "Unique across all Nodes user-defined name."
        },
        "machine_id": {
          "type": "string",
          "description": "Linux machine-id."
        },
        "distro": {
          "type": "string",
          "description": "Linux distribution name and version."
        },
        "container_id": {
          "type": "string",
          "description": "Container identifier. If specified, must be a unique Docker container identifier."
        },
        "container_name": {
          "type": "string",
          "description": "Container name."
        },
        "node_model": {
          "type": "string",
          "description": "Node model."
        },
        "region": {
          "type": "string",
          "description": "Node region."
        },
        "az": {
          "type": "string",
          "description": "Node availability zone."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Node."
        }
      },
      "description": "AddNodeParams holds node params and is used to add new node to inventory while adding new service."
    },
    "managementAddPostgreSQLRequest": {
      "type": "object",
      "properties": {
        "node_id": {
          "type": "string",
          "description": "Node identifier on which a service is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "node_name": {
          "type": "string",
          "description": "Node name on which a service is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "add_node": {
          "$ref": "#/definitions/managementAddNodeParams",
          "description": "Create a new Node with those parameters.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name. Required."
        },
        "address": {
          "type": "string",
          "description": "Node and Service access address (DNS name or IP).\nAddress (and port) or socket is required."
        },
        "port": {
          "type": "integer",
          "format": "int64",
          "description": "Service Access port.\nPort is required when the address present."
        },
        "database": {
          "type": "string",
          "description": "Database name."
        },
        "socket": {
          "type": "string",
          "description": "Service Access socket.\nAddress (and port) or socket is required."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The \"pmm-agent\" identifier which should run agents. Required."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "username": {
          "type": "string",
          "description": "PostgreSQL username for scraping metrics."
        },
        "password": {
          "type": "string",
          "description": "PostgreSQL password for scraping metrics."
        },
        "qan_postgresql_pgstatements_agent": {
          "type": "boolean",
          "description": "If true, adds qan-postgresql-pgstatements-agent for provided service."
        },
        "qan_postgresql_pgstatmonitor_agent": {
          "type": "boolean",
          "description": "If true, adds qan-postgresql-pgstatmonitor-agent for provided service."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit)."
        },
        "disable_query_examples": {
          "type": "boolean",
          "description": "Disable query examples."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Service."
        },
        "skip_connection_check": {
          "type": "boolean",
          "description": "Skip connection check."
        },
        "disable_comments_parsing": {
          "type": "boolean",
          "description": "Disable parsing comments from queries and showing them in QAN."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation. Uses sslmode=required instead of verify-full."
        },
        "metrics_mode": {
          "$ref": "#/definitions/managementMetricsMode",
          "description": "Defines metrics flow model for this exporter.\nMetrics could be pushed to the server with vmagent,\npulled by the server, or the server could choose behavior automatically."
        },
        "disable_collectors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of collector names to disable in this exporter."
        },
        "tls_ca": {
          "type": "string",
          "description": "TLS CA certificate."
        },
        "tls_cert": {
          "type": "string",
          "description": "TLS Certifcate."
        },
        "tls_key": {
          "type": "string",
          "description": "TLS Certificate Key."
        },
        "agent_password": {
          "type": "string",
          "description": "Custom password for exporter endpoint /metrics."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "title": "Exporter log level"
        }
      }
    },
    "managementAddPostgreSQLResponse": {
      "type": "object",
      "properties": {
        "service": {
          "$ref": "#/definitions/inventoryPostgreSQLService"
        },
        "postgres_exporter": {
          "$ref": "#/definitions/inventoryPostgresExporter"
        },
        "qan_postgresql_pgstatements_agent": {
          "$ref": "#/definitions/inventoryQANPostgreSQLPgStatementsAgent"
        },
        "qan_postgresql_pgstatmonitor_agent": {
          "$ref": "#/definitions/inventoryQANPostgreSQLPgStatMonitorAgent"
        }
      }
    },
    "managementMetricsMode": {
      "type": "string",
      "enum": [
        "AUTO",
        "PULL",
        "PUSH"
      ],
      "default": "AUTO",
      "description": "MetricsMode defines desired metrics mode for agent,\nit can be pull, push or auto mode chosen by server."
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    }
  }
}
