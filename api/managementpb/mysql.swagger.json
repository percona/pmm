{
  "swagger": "2.0",
  "info": {
    "title": "managementpb/mysql.proto",
    "version": "version not set"
  },
  "tags": [
    {
      "name": "MySQL"
    }
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/management/MySQL/Add": {
      "post": {
        "summary": "Add MySQL",
        "description": "Adds MySQL Service and starts several Agents. It automatically adds a service to inventory, which is running on the provided \"node_id\", then adds \"mysqld_exporter\", and \"qan_mysql_perfschema\" agents with the provided \"pmm_agent_id\" and other parameters.",
        "operationId": "AddMySQL",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/managementAddMySQLResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/managementAddMySQLRequest"
            }
          }
        ],
        "tags": [
          "MySQL"
        ]
      }
    }
  },
  "definitions": {
    "inventoryAgentStatus": {
      "type": "string",
      "enum": [
        "AGENT_STATUS_INVALID",
        "STARTING",
        "RUNNING",
        "WAITING",
        "STOPPING",
        "DONE",
        "UNKNOWN"
      ],
      "default": "AGENT_STATUS_INVALID",
      "description": "AgentStatus represents actual Agent status.\n\n - STARTING: Agent is starting.\n - RUNNING: Agent is running.\n - WAITING: Agent encountered error and will be restarted automatically soon.\n - STOPPING: Agent is stopping.\n - DONE: Agent finished.\n - UNKNOWN: Agent is not connected, we don't know anything about it's state."
    },
    "inventoryLogLevel": {
      "type": "string",
      "enum": [
        "auto",
        "fatal",
        "error",
        "warn",
        "info",
        "debug"
      ],
      "default": "auto",
      "title": "Log level for exporters"
    },
    "inventoryMySQLService": {
      "type": "object",
      "properties": {
        "service_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name."
        },
        "node_id": {
          "type": "string",
          "description": "Node identifier where this instance runs."
        },
        "address": {
          "type": "string",
          "description": "Access address (DNS name or IP).\nAddress (and port) or socket is required."
        },
        "port": {
          "type": "integer",
          "format": "int64",
          "description": "Access port.\nPort is required when the address present."
        },
        "socket": {
          "type": "string",
          "description": "Access unix socket.\nAddress (and port) or socket is required."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        }
      },
      "description": "MySQLService represents a generic MySQL instance."
    },
    "inventoryMySQLdExporter": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "MySQL username for scraping metrics."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "tls_ca": {
          "type": "string",
          "description": "Certificate Authority certificate chain."
        },
        "tls_cert": {
          "type": "string",
          "description": "Client certificate."
        },
        "tls_key": {
          "type": "string",
          "description": "Password for decrypting tls_cert."
        },
        "tablestats_group_table_limit": {
          "type": "integer",
          "format": "int32",
          "description": "Tablestats group collectors are disabled if there are more than that number of tables.\n0 means tablestats group collectors are always enabled (no limit).\nNegative value means tablestats group collectors are always disabled."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        },
        "push_metrics_enabled": {
          "type": "boolean",
          "description": "True if exporter uses push metrics mode."
        },
        "disabled_collectors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of disabled collector names.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "listen_port": {
          "type": "integer",
          "format": "int64",
          "description": "Listen port for scraping metrics."
        },
        "tablestats_group_disabled": {
          "type": "boolean",
          "description": "True if tablestats group collectors are currently disabled."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "MySQLdExporter runs on Generic or Container Node and exposes MySQL Service metrics."
    },
    "inventoryNodeType": {
      "type": "string",
      "enum": [
        "NODE_TYPE_INVALID",
        "GENERIC_NODE",
        "CONTAINER_NODE",
        "REMOTE_NODE",
        "REMOTE_RDS_NODE",
        "REMOTE_AZURE_DATABASE_NODE"
      ],
      "default": "NODE_TYPE_INVALID",
      "description": "NodeType describes supported Node types."
    },
    "inventoryQANMySQLPerfSchemaAgent": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "MySQL username for getting performance data."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "tls_ca": {
          "type": "string",
          "description": "Certificate Authority certificate chain."
        },
        "tls_cert": {
          "type": "string",
          "description": "Client certificate."
        },
        "tls_key": {
          "type": "string",
          "description": "Password for decrypting tls_cert."
        },
        "disable_comments_parsing": {
          "type": "boolean",
          "description": "Disable parsing comments from queries and showing them in QAN."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit)."
        },
        "query_examples_disabled": {
          "type": "boolean",
          "description": "True if query examples are disabled."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "QANMySQLPerfSchemaAgent runs within pmm-agent and sends MySQL Query Analytics data to the PMM Server."
    },
    "inventoryQANMySQLSlowlogAgent": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "MySQL username for getting performance data."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "tls_ca": {
          "type": "string",
          "description": "Certificate Authority certificate chain."
        },
        "tls_cert": {
          "type": "string",
          "description": "Client certificate."
        },
        "tls_key": {
          "type": "string",
          "description": "Password for decrypting tls_cert."
        },
        "disable_comments_parsing": {
          "type": "boolean",
          "description": "Disable parsing comments from queries and showing them in QAN."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "title": "Limit query length in QAN (default: server-defined; -1: no limit)"
        },
        "query_examples_disabled": {
          "type": "boolean",
          "description": "True if query examples are disabled."
        },
        "max_slowlog_file_size": {
          "type": "string",
          "format": "int64",
          "description": "Slowlog file is rotated at this size if \u003e 0."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "process_exec_path": {
          "type": "string",
          "title": "mod tidy"
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "QANMySQLSlowlogAgent runs within pmm-agent and sends MySQL Query Analytics data to the PMM Server."
    },
    "managementAddMySQLRequest": {
      "type": "object",
      "properties": {
        "node_id": {
          "type": "string",
          "description": "Node identifier on which a service is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "node_name": {
          "type": "string",
          "description": "Node name on which a service is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "add_node": {
          "$ref": "#/definitions/managementAddNodeParams",
          "description": "Create a new Node with those parameters.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name. Required."
        },
        "address": {
          "type": "string",
          "description": "Node and Service access address (DNS name or IP).\nAddress (and port) or socket is required."
        },
        "port": {
          "type": "integer",
          "format": "int64",
          "description": "Service Access port.\nPort is required when the address present."
        },
        "socket": {
          "type": "string",
          "description": "Service Access socket.\nAddress (and port) or socket is required."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The \"pmm-agent\" identifier which should run agents. Required."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "username": {
          "type": "string",
          "description": "MySQL username for scraping metrics."
        },
        "password": {
          "type": "string",
          "description": "MySQL password for scraping metrics."
        },
        "qan_mysql_perfschema": {
          "type": "boolean",
          "description": "If true, adds qan-mysql-perfschema-agent for provided service."
        },
        "qan_mysql_slowlog": {
          "type": "boolean",
          "description": "If true, adds qan-mysql-slowlog-agent for provided service."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Service."
        },
        "skip_connection_check": {
          "type": "boolean",
          "description": "Skip connection check."
        },
        "disable_comments_parsing": {
          "type": "boolean",
          "description": "Disable parsing comments from queries and showing them in QAN."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit)."
        },
        "disable_query_examples": {
          "type": "boolean",
          "description": "Disable query examples."
        },
        "max_slowlog_file_size": {
          "type": "string",
          "format": "int64",
          "description": "If qan-mysql-slowlog-agent is added, slowlog file is rotated at this size if \u003e 0.\nIf zero, server's default value is used.\nUse negative value to disable rotation."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "tls_ca": {
          "type": "string",
          "description": "Certificate Authority certificate chain."
        },
        "tls_cert": {
          "type": "string",
          "description": "Client certificate."
        },
        "tls_key": {
          "type": "string",
          "description": "Password for decrypting tls_cert."
        },
        "tablestats_group_table_limit": {
          "type": "integer",
          "format": "int32",
          "description": "Tablestats group collectors will be disabled if there are more than that number of tables.\nIf zero, server's default value is used.\nUse negative value to disable them."
        },
        "metrics_mode": {
          "$ref": "#/definitions/managementMetricsMode",
          "description": "Defines metrics flow model for this exporter.\nMetrics could be pushed to the server with vmagent,\npulled by the server, or the server could choose behavior automatically."
        },
        "disable_collectors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of collector names to disable in this exporter."
        },
        "agent_password": {
          "type": "string",
          "description": "Custom password for exporter endpoint /metrics."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "title": "Exporter log level"
        }
      }
    },
    "managementAddMySQLResponse": {
      "type": "object",
      "properties": {
        "service": {
          "$ref": "#/definitions/inventoryMySQLService"
        },
        "mysqld_exporter": {
          "$ref": "#/definitions/inventoryMySQLdExporter"
        },
        "qan_mysql_perfschema": {
          "$ref": "#/definitions/inventoryQANMySQLPerfSchemaAgent"
        },
        "qan_mysql_slowlog": {
          "$ref": "#/definitions/inventoryQANMySQLSlowlogAgent"
        },
        "table_count": {
          "type": "integer",
          "format": "int32",
          "description": "Actual table count at the moment of adding."
        }
      }
    },
    "managementAddNodeParams": {
      "type": "object",
      "properties": {
        "node_type": {
          "$ref": "#/definitions/inventoryNodeType",
          "description": "Node type to be registered."
        },
        "node_name": {
          "type": "string",
          "description": "Unique across all Nodes user-defined name."
        },
        "machine_id": {
          "type": "string",
          "description": "Linux machine-id."
        },
        "distro": {
          "type": "string",
          "description": "Linux distribution name and version."
        },
        "container_id": {
          "type": "string",
          "description": "Container identifier. If specified, must be a unique Docker container identifier."
        },
        "container_name": {
          "type": "string",
          "description": "Container name."
        },
        "node_model": {
          "type": "string",
          "description": "Node model."
        },
        "region": {
          "type": "string",
          "description": "Node region."
        },
        "az": {
          "type": "string",
          "description": "Node availability zone."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Node."
        }
      },
      "description": "AddNodeParams holds node params and is used to add new node to inventory while adding new service."
    },
    "managementMetricsMode": {
      "type": "string",
      "enum": [
        "AUTO",
        "PULL",
        "PUSH"
      ],
      "default": "AUTO",
      "description": "MetricsMode defines desired metrics mode for agent,\nit can be pull, push or auto mode chosen by server."
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    }
  }
}
