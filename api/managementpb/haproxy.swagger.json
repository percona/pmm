{
  "swagger": "2.0",
  "info": {
    "title": "managementpb/haproxy.proto",
    "version": "version not set"
  },
  "tags": [
    {
      "name": "HAProxy"
    }
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/management/HAProxy/Add": {
      "post": {
        "summary": "Add HAProxy",
        "description": "Adds HAProxy service and external exporter. It automatically adds a service to inventory, which is running on the provided \"node_id\", then adds an \"external exporter\" agent to the inventory.",
        "operationId": "AddHAProxy",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/managementAddHAProxyResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/managementAddHAProxyRequest"
            }
          }
        ],
        "tags": [
          "HAProxy"
        ]
      }
    }
  },
  "definitions": {
    "inventoryExternalExporter": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "runs_on_node_id": {
          "type": "string",
          "description": "Node identifier where this instance runs."
        },
        "disabled": {
          "type": "boolean",
          "description": "If disabled, metrics from this exporter will not be collected."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "HTTP basic auth username for collecting metrics."
        },
        "scheme": {
          "type": "string",
          "description": "Scheme to generate URI to exporter metrics endpoints."
        },
        "metrics_path": {
          "type": "string",
          "description": "Path under which metrics are exposed, used to generate URI."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        },
        "listen_port": {
          "type": "integer",
          "format": "int64",
          "description": "Listen port for scraping metrics."
        },
        "push_metrics_enabled": {
          "type": "boolean",
          "description": "True if exporter uses push metrics mode."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        }
      },
      "description": "ExternalExporter runs on any Node type, including Remote Node."
    },
    "inventoryHAProxyService": {
      "type": "object",
      "properties": {
        "service_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name."
        },
        "node_id": {
          "type": "string",
          "description": "Node identifier where this service instance runs."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        }
      },
      "description": "HAProxyService represents a generic HAProxy service instance."
    },
    "inventoryNodeType": {
      "type": "string",
      "enum": [
        "NODE_TYPE_INVALID",
        "GENERIC_NODE",
        "CONTAINER_NODE",
        "REMOTE_NODE",
        "REMOTE_RDS_NODE",
        "REMOTE_AZURE_DATABASE_NODE"
      ],
      "default": "NODE_TYPE_INVALID",
      "description": "NodeType describes supported Node types."
    },
    "managementAddHAProxyRequest": {
      "type": "object",
      "properties": {
        "node_id": {
          "type": "string",
          "description": "Node identifier on which an external exporter is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "node_name": {
          "type": "string",
          "description": "Node name on which a service and node is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "add_node": {
          "$ref": "#/definitions/managementAddNodeParams",
          "description": "Create a new Node with those parameters.\nadd_node always should be passed with address.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "address": {
          "type": "string",
          "description": "Node and Exporter access address (DNS name or IP).\naddress always should be passed with add_node."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name. Required."
        },
        "username": {
          "type": "string",
          "description": "HTTP basic auth username for collecting metrics."
        },
        "password": {
          "type": "string",
          "description": "HTTP basic auth password for collecting metrics."
        },
        "scheme": {
          "type": "string",
          "description": "Scheme to generate URI to exporter metrics endpoints."
        },
        "metrics_path": {
          "type": "string",
          "description": "Path under which metrics are exposed, used to generate URI."
        },
        "listen_port": {
          "type": "integer",
          "format": "int64",
          "description": "Listen port for scraping metrics."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Service."
        },
        "metrics_mode": {
          "$ref": "#/definitions/managementMetricsMode",
          "description": "Defines metrics flow model for this exporter.\nMetrics could be pushed to the server with vmagent,\npulled by the server, or the server could choose behavior automatically.\nNode with registered pmm_agent_id must present at pmm-server\nin case of push metrics_mode."
        },
        "skip_connection_check": {
          "type": "boolean",
          "description": "Skip connection check."
        }
      }
    },
    "managementAddHAProxyResponse": {
      "type": "object",
      "properties": {
        "service": {
          "$ref": "#/definitions/inventoryHAProxyService"
        },
        "external_exporter": {
          "$ref": "#/definitions/inventoryExternalExporter"
        }
      }
    },
    "managementAddNodeParams": {
      "type": "object",
      "properties": {
        "node_type": {
          "$ref": "#/definitions/inventoryNodeType",
          "description": "Node type to be registered."
        },
        "node_name": {
          "type": "string",
          "description": "Unique across all Nodes user-defined name."
        },
        "machine_id": {
          "type": "string",
          "description": "Linux machine-id."
        },
        "distro": {
          "type": "string",
          "description": "Linux distribution name and version."
        },
        "container_id": {
          "type": "string",
          "description": "Container identifier. If specified, must be a unique Docker container identifier."
        },
        "container_name": {
          "type": "string",
          "description": "Container name."
        },
        "node_model": {
          "type": "string",
          "description": "Node model."
        },
        "region": {
          "type": "string",
          "description": "Node region."
        },
        "az": {
          "type": "string",
          "description": "Node availability zone."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Node."
        }
      },
      "description": "AddNodeParams holds node params and is used to add new node to inventory while adding new service."
    },
    "managementMetricsMode": {
      "type": "string",
      "enum": [
        "AUTO",
        "PULL",
        "PUSH"
      ],
      "default": "AUTO",
      "description": "MetricsMode defines desired metrics mode for agent,\nit can be pull, push or auto mode chosen by server."
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    }
  }
}
