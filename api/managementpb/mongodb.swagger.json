{
  "swagger": "2.0",
  "info": {
    "title": "managementpb/mongodb.proto",
    "version": "version not set"
  },
  "tags": [
    {
      "name": "MongoDB"
    }
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/management/MongoDB/Add": {
      "post": {
        "summary": "Add MongoDB",
        "description": "Adds MongoDB Service and starts several Agents. It automatically adds a service to inventory, which is running on the provided \"node_id\", then adds \"mongodb_exporter\", and \"qan_mongodb_profiler\" agents with the provided \"pmm_agent_id\" and other parameters.",
        "operationId": "AddMongoDB",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/managementAddMongoDBResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/managementAddMongoDBRequest"
            }
          }
        ],
        "tags": [
          "MongoDB"
        ]
      }
    }
  },
  "definitions": {
    "inventoryAgentStatus": {
      "type": "string",
      "enum": [
        "AGENT_STATUS_INVALID",
        "STARTING",
        "RUNNING",
        "WAITING",
        "STOPPING",
        "DONE",
        "UNKNOWN"
      ],
      "default": "AGENT_STATUS_INVALID",
      "description": "AgentStatus represents actual Agent status.\n\n - STARTING: Agent is starting.\n - RUNNING: Agent is running.\n - WAITING: Agent encountered error and will be restarted automatically soon.\n - STOPPING: Agent is stopping.\n - DONE: Agent finished.\n - UNKNOWN: Agent is not connected, we don't know anything about it's state."
    },
    "inventoryLogLevel": {
      "type": "string",
      "enum": [
        "auto",
        "fatal",
        "error",
        "warn",
        "info",
        "debug"
      ],
      "default": "auto",
      "title": "Log level for exporters"
    },
    "inventoryMongoDBExporter": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "MongoDB username for scraping metrics."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        },
        "push_metrics_enabled": {
          "type": "boolean",
          "description": "True if exporter uses push metrics mode."
        },
        "disabled_collectors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of disabled collector names.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "listen_port": {
          "type": "integer",
          "format": "int64",
          "description": "Listen port for scraping metrics."
        },
        "stats_collections": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "title": "List of colletions to get stats from. Can use *"
        },
        "collections_limit": {
          "type": "integer",
          "format": "int32",
          "title": "Collections limit. Only get Databases and collection stats if the total number of collections in the server\nis less than this value. 0: no limit"
        },
        "enable_all_collectors": {
          "type": "boolean",
          "description": "Enable All collectors."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "MongoDBExporter runs on Generic or Container Node and exposes MongoDB Service metrics."
    },
    "inventoryMongoDBService": {
      "type": "object",
      "properties": {
        "service_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name."
        },
        "node_id": {
          "type": "string",
          "description": "Node identifier where this instance runs."
        },
        "address": {
          "type": "string",
          "description": "Access address (DNS name or IP).\nAddress (and port) or socket is required."
        },
        "port": {
          "type": "integer",
          "format": "int64",
          "description": "Access port.\nPort is required when the address present."
        },
        "socket": {
          "type": "string",
          "description": "Access unix socket.\nAddress (and port) or socket is required."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels."
        }
      },
      "description": "MongoDBService represents a generic MongoDB instance."
    },
    "inventoryNodeType": {
      "type": "string",
      "enum": [
        "NODE_TYPE_INVALID",
        "GENERIC_NODE",
        "CONTAINER_NODE",
        "REMOTE_NODE",
        "REMOTE_RDS_NODE",
        "REMOTE_AZURE_DATABASE_NODE"
      ],
      "default": "NODE_TYPE_INVALID",
      "description": "NodeType describes supported Node types."
    },
    "inventoryQANMongoDBProfilerAgent": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "Unique randomly generated instance identifier."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The pmm-agent identifier which runs this instance."
        },
        "disabled": {
          "type": "boolean",
          "description": "Desired Agent status: enabled (false) or disabled (true)."
        },
        "service_id": {
          "type": "string",
          "description": "Service identifier."
        },
        "username": {
          "type": "string",
          "description": "MongoDB username for getting profiler data."
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit).\n\nTrue if query examples are disabled.\n bool query_examples_disabled = 8; TODO https://jira.percona.com/browse/PMM-4650"
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels.\n\nStatus fields below."
        },
        "status": {
          "$ref": "#/definitions/inventoryAgentStatus",
          "description": "Actual Agent status."
        },
        "process_exec_path": {
          "type": "string",
          "description": "Path to exec process."
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "description": "Log level for exporter."
        }
      },
      "description": "QANMongoDBProfilerAgent runs within pmm-agent and sends MongoDB Query Analytics data to the PMM Server."
    },
    "managementAddMongoDBRequest": {
      "type": "object",
      "properties": {
        "node_id": {
          "type": "string",
          "description": "Node identifier on which a service is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "node_name": {
          "type": "string",
          "description": "Node name on which a service is been running.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "add_node": {
          "$ref": "#/definitions/managementAddNodeParams",
          "description": "Create a new Node with those parameters.\nExactly one of these parameters should be present: node_id, node_name, add_node."
        },
        "service_name": {
          "type": "string",
          "description": "Unique across all Services user-defined name. Required."
        },
        "address": {
          "type": "string",
          "description": "Node and Service access address (DNS name or IP).\nAddress (and port) or socket is required."
        },
        "port": {
          "type": "integer",
          "format": "int64",
          "description": "Service Access port.\nPort is required when the address present."
        },
        "socket": {
          "type": "string",
          "description": "Service Access socket.\nAddress (and port) or socket is required."
        },
        "pmm_agent_id": {
          "type": "string",
          "description": "The \"pmm-agent\" identifier which should run agents. Required."
        },
        "environment": {
          "type": "string",
          "description": "Environment name."
        },
        "cluster": {
          "type": "string",
          "description": "Cluster name."
        },
        "replication_set": {
          "type": "string",
          "description": "Replication set name."
        },
        "username": {
          "type": "string",
          "description": "MongoDB username for exporter and QAN agent access."
        },
        "password": {
          "type": "string",
          "description": "MongoDB password for exporter and QAN agent access."
        },
        "qan_mongodb_profiler": {
          "type": "boolean",
          "description": "If true, adds qan-mongodb-profiler-agent for provided service."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Service."
        },
        "skip_connection_check": {
          "type": "boolean",
          "description": "Skip connection check.\n\nDisable query examples.\n bool disable_query_examples = 16; TODO https://jira.percona.com/browse/PMM-4650"
        },
        "tls": {
          "type": "boolean",
          "description": "Use TLS for database connections."
        },
        "tls_skip_verify": {
          "type": "boolean",
          "description": "Skip TLS certificate and hostname validation."
        },
        "tls_certificate_key": {
          "type": "string",
          "description": "Client certificate and key."
        },
        "tls_certificate_key_file_password": {
          "type": "string",
          "description": "Password for decrypting tls_certificate_key."
        },
        "tls_ca": {
          "type": "string",
          "description": "Certificate Authority certificate chain."
        },
        "max_query_length": {
          "type": "integer",
          "format": "int32",
          "description": "Limit query length in QAN (default: server-defined; -1: no limit)."
        },
        "metrics_mode": {
          "$ref": "#/definitions/managementMetricsMode",
          "description": "Defines metrics flow model for this exporter.\nMetrics could be pushed to the server with vmagent,\npulled by the server, or the server could choose behavior automatically."
        },
        "disable_collectors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of collector names to disable in this exporter."
        },
        "authentication_mechanism": {
          "type": "string",
          "description": "Authentication mechanism.\nSee https://docs.mongodb.com/manual/reference/connection-string/#mongodb-urioption-urioption.authMechanism\nfor details."
        },
        "authentication_database": {
          "type": "string",
          "description": "Authentication database."
        },
        "agent_password": {
          "type": "string",
          "description": "Custom password for exporter endpoint /metrics."
        },
        "stats_collections": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of collections to get stats from. Can use * ."
        },
        "collections_limit": {
          "type": "integer",
          "format": "int32",
          "title": "Collections limit. Only get Databases and collection stats if the total number of collections in the server\nis less than this value. 0: no limit"
        },
        "enable_all_collectors": {
          "type": "boolean",
          "title": "Enable all collectors"
        },
        "log_level": {
          "$ref": "#/definitions/inventoryLogLevel",
          "title": "Exporter log level"
        }
      }
    },
    "managementAddMongoDBResponse": {
      "type": "object",
      "properties": {
        "service": {
          "$ref": "#/definitions/inventoryMongoDBService"
        },
        "mongodb_exporter": {
          "$ref": "#/definitions/inventoryMongoDBExporter"
        },
        "qan_mongodb_profiler": {
          "$ref": "#/definitions/inventoryQANMongoDBProfilerAgent"
        }
      }
    },
    "managementAddNodeParams": {
      "type": "object",
      "properties": {
        "node_type": {
          "$ref": "#/definitions/inventoryNodeType",
          "description": "Node type to be registered."
        },
        "node_name": {
          "type": "string",
          "description": "Unique across all Nodes user-defined name."
        },
        "machine_id": {
          "type": "string",
          "description": "Linux machine-id."
        },
        "distro": {
          "type": "string",
          "description": "Linux distribution name and version."
        },
        "container_id": {
          "type": "string",
          "description": "Container identifier. If specified, must be a unique Docker container identifier."
        },
        "container_name": {
          "type": "string",
          "description": "Container name."
        },
        "node_model": {
          "type": "string",
          "description": "Node model."
        },
        "region": {
          "type": "string",
          "description": "Node region."
        },
        "az": {
          "type": "string",
          "description": "Node availability zone."
        },
        "custom_labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Custom user-assigned labels for Node."
        }
      },
      "description": "AddNodeParams holds node params and is used to add new node to inventory while adding new service."
    },
    "managementMetricsMode": {
      "type": "string",
      "enum": [
        "AUTO",
        "PULL",
        "PUSH"
      ],
      "default": "AUTO",
      "description": "MetricsMode defines desired metrics mode for agent,\nit can be pull, push or auto mode chosen by server."
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    }
  }
}
