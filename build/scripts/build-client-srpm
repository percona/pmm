#!/bin/bash

. $(dirname $0)/vars

main() {
  echo -----------------------------------------
  echo "Building PMM Client source RPM packages..."
  echo -----------------------------------------

  local IMAGE=${1:-${rpmbuild_docker_image}}
  docker run --rm \
    --platform=${platform} \
    -v ${bin_dir}:/home/builder/bin \
    -v ${build_dir}:/home/builder/build \
    ${IMAGE} sh -c "
      set -o errexit
      set -o xtrace

      sudo_path=
      if [ -e /usr/bin/sudo ]; then
          sudo_path=/usr/bin/sudo
      fi

      [[ ${IMAGE} = ${rpmbuild_docker_image} ]] || \$sudo_path yum -y install git rpm-build

      export pmm_release=$pmm_release
      cd /home/builder/build

      /home/builder/bin/build-client-packages --build_src_rpm
    "
}

main $*

# vim: expandtab shiftwidth=2 tabstop=2
