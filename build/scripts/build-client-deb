#!/bin/bash

. "$(dirname "$0")/vars"

main() {
  local IMAGE=${1:-ubuntu:focal}
  docker run --rm \
    -e DEBIAN_FRONTEND=noninteractive \
    -e PMM_VERSION="${pmm_version}" \
    -e PMM_RELEASE="${pmm_release}" \
    -v "${bin_dir}":/home/builder/bin \
    -v "${build_dir}":/home/builder/build \
    -w /home/builder/build \
    --entrypoint="/home/builder/bin/build-client-entrypoint" \
    "${IMAGE}" --build_source_deb

  docker run --rm \
    -e DEBIAN_FRONTEND=noninteractive \
    -e PMM_VERSION="${pmm_version}" \
    -e PMM_RELEASE="${pmm_release}" \
    -v "${bin_dir}":/home/builder/bin \
    -v "${build_dir}":/home/builder/build \
    -w /home/builder/build \
    --entrypoint="/home/builder/bin/build-client-entrypoint" \
    "${IMAGE}" --build_deb
}

main "$*"

# vim: expandtab shiftwidth=2 tabstop=2
