---
- name: Add PostgreSQL 14 YUM repository
  yum_repository:
    name: percona-ppg-14
    description: PostgreSQL YUM repository
    baseurl: http://repo.percona.com/ppg-14/yum/release/$releasever/RPMS/$basearch/
    gpgcheck: yes
    enabled: yes
    gpgkey: file:///etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY

- name: Install Postgres
  when:
    - not ansible_check_mode
  yum:
    name:
      - percona-postgresql14-server
      - percona-postgresql14-contrib
      - percona-postgresql14
      - python3-psycopg2 # Python PostgreSQL database adapter
    state: installed

- name: Create a socket directory for Postgres
  file:
    path: /run/postgresql
    state: directory
    mode: 0777
