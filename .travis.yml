language: go

go:
  - 1.11.x
  - master

matrix:
  allow_failures:
    - go: master

before_install:
  # install binary protoc release
  - curl -L https://github.com/google/protobuf/releases/download/v3.6.1/protoc-3.6.1-linux-x86_64.zip -o ~/protoc.zip
  - unzip -q ~/protoc.zip -d ~
  - sudo install -d /usr/local/include/google/protobuf/compiler
  - sudo install -m 755 ~/bin/protoc /usr/local/bin/
  - sudo install -m 644 ~/include/google/protobuf/*.proto /usr/local/include/google/protobuf/
  - sudo install -m 644 ~/include/google/protobuf/compiler/*.proto /usr/local/include/google/protobuf/compiler/
  - protoc --version

install:
  # ensure that Gopkg.lock is up-to-date
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
  - make -C api init
  - cd api && dep check && cd ..

script:
  - make -C api gen

  # check that generated files are up-to-date
  - git status
  - git diff --exit-code

notifications:
  slack:
    on_success: change
    on_failure: always
    rooms:
      secure: Iy3M4BJaSmkyjwibcEW60i7R+PZJOPTgdvdTB6h7iN5uqqAjhRaA36ujyjyO1swjaP4/t8gJb0IKSd+fYhEedXAReTRPYsYkRDO0Z9MblwT/8XH43eMnRcEjvy1l3ovcOXcfYFCxWv11duBWUpAsnUNexPFsFmEjic7wJvx291iHokrKIq7Ue4TUIqNq0c8ZRmHyTFC+c9RjyO6ouVX64T7h1i4wtDFjlFyrPBipGJenhlJsk93KnuWoSSvmW1Ndz5Mg8Kx09oOrW/JXozjs8Q9sj8GlDQrutv7u8bYX8udL7LG9SHxlBr+ZopKqDA4YlAsZLvq6tEh8cj2w/1hvoU+E/Ei4kP6CIDC0G2iGCsSZGD5lwNHfMZlYav0bMCehB0GsWXFEWz01f7Vkv5rhRL03ODCRjxv3S9o4+OQPIma8W379zYfJ0KeWDUUCraPI7E23RaeyPSzsk2sCzusKlJo3ZQs3sban4uIqjNcN0M44H/of0s+mhF8r/Bnn8QQ2oM7nZASbHKSnuMXtX5+Fht+aC4O1df7E4ICnvRoUdxk0gGtIe1RCKfJc/mcYZZkOaApbyZ+nQLKAs1rCfw0P24QNCsSra4UrtHLX70xs8hR15wJWqCRaDkeCM0Ow2LHjer8/MWwT41wcTih0q4bPtvZlju9X6WgdboYlxA8NSmE=
