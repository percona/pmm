global
    log stdout    local0 debug
    log stdout    local1 info
    log stdout    local2 info
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend http_front
    bind *:80
    default_backend http_back

frontend https_front
    bind *:443 ssl crt /usr/local/etc/ssl/private/localhost.pem
    default_backend https_back

backend http_back
    # Round-robin load balancing across all healthy nodes
    balance roundrobin
    option httpchk
    # Use readiness health check instead of leader-only check
    http-check send meth GET uri /v1/readyz ver HTTP/1.1 hdr Host www
    http-check expect status 200
    # All servers active (no backup) - route to any healthy node
    server pmm-server-active-http pmm-server-active:8080 check
    server pmm-server-passive-http pmm-server-passive:8080 check
    server pmm-server-passive-2-http pmm-server-passive-2:8080 check

backend https_back
    # Round-robin load balancing across all healthy nodes
    balance roundrobin
    option httpchk
    # Use readiness health check instead of leader-only check
    http-check send meth GET uri /v1/readyz ver HTTP/1.1 hdr Host www
    http-check expect status 200
    # All servers active (no backup) - route to any healthy node
    server pmm-server-active-https pmm-server-active:8443 check ssl verify none
    server pmm-server-passive-https pmm-server-passive:8443 check ssl verify none
    server pmm-server-passive-2-https pmm-server-passive-2:8443 check ssl verify none

