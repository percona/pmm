---
checks:
  - version: 2
    name: mysql_test_database
    summary: MySQL test Database
    description: This check returns a notice if there are databases with name 'test' or 'test_%'.
    family: MYSQL
    advisor: configuration_generic
    interval: standard
    queries:
      - type: MYSQL_SHOW
        query: "DATABASES WHERE `Database` = 'test' or `Database` like 'test_%'"
    script: |
      def check_context(docs, context):
          """
          This check returns a notice if database with name 'test' or 'test_%' are discovered.
          """

          dbs = []

          rows = docs[0]
          for row in rows:
              db = row.get("Database")
              dbs.append(db)

          if dbs:
              description = "s are"
              if len(dbs) == 1:
                  description = " is"
              return [{
                  "summary": "Test database{} detected: {}".format(description,dbs),
                  "description": "Please Improve MySQL Installation Security by running program mysql_secure_installation",
                  "severity": "notice"
          }]

          return []
